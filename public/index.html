<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Multisweeper</title>
		<link rel="stylesheet" href="style.css">
		<script
			src="https://code.jquery.com/jquery-3.7.1.min.js"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.socket.io/4.8.1/socket.io.min.js"
			integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+"
			crossorigin="anonymous"
		></script>
	</head>
	<body>
		<!-- Login / Registration Modal -->
		<div id="loginModal" class="modal">
			<div class="modal-content login-split-container" style="position: relative;">
				<button
					id="loginHelpBtn"
					class="icon-btn"
					style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.1); color: #333; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; border: none; font-size: 14px;"
				>
					?
				</button>
				<div class="login-section">
					<h2>Register</h2>
					<input
						type="text"
						id="regUsername"
						placeholder="Username"
						autocomplete="off"
					>
					<input
						type="text"
						id="regNickname"
						placeholder="Nickname"
						autocomplete="off"
					>
					<input
						type="password"
						id="regPassword"
						placeholder="Password"
						autocomplete="off"
					>
					<input
						type="password"
						id="regConfirmPassword"
						placeholder="Confirm Password"
						autocomplete="off"
					>
					<button
						id="registerBtn"
						type="button"
						class="big-btn"
						onclick="handleRegister()"
					>
						Register
					</button>
				</div>
				<div class="login-divider"></div>
				<div class="login-section">
					<h2>Login</h2>
					<input
						type="text"
						id="loginUsername"
						placeholder="Username"
						autocomplete="off"
					>
					<input
						type="password"
						id="loginPassword"
						placeholder="Password"
						autocomplete="off"
					>
					<button
						id="loginBtn"
						type="button"
						class="big-btn"
						onclick="handleLogin()"
					>
						Login
					</button>
				</div>

				<p
					id="loginMsg"
					style="position:absolute; bottom:15px; left:0; right:0; margin:0; font-weight:bold; opacity:0; transition:opacity 0.5s;"
				></p>
			</div>
		</div>

		<!-- Main Lobby Page -->
		<div id="mainPage" style="display:none">
			<div class="header">
				<h1>Multisweeper</h1>
				<button id="logoutBtn" class="big-btn">Logout</button>
				<!-- side menu toggle injected in side-menu partial -->
			</div>

			<div class="container">
				<!-- Left Panel -->
				<div class="left-panel">
					<h2>
						Welcome, <span id="welcomeUser"></span>!
					</h2>

					<div id="lobbySelection">
						<h3 style="margin:20px 0 10px;">Join a Room</h3>

						<div id="lobbyListContainer" class="lobby-list">
							<div style="padding:10px; color:#888; text-align:center;">
								Loading rooms...
							</div>
						</div>

						<div class="join-box" style="margin-bottom:25px;">
							<input type="text" id="roomInput" placeholder="Enter Room ID">
							<button id="joinLobbyBtn">Join Room</button>
						</div>

						<h3 style="margin:20px 0 10px;">Or Create New Room</h3>
						<input
							type="text"
							id="roomNameInput"
							placeholder="Room Name (optional)"
						>
						
						<div style="margin: 15px 0;">
							<label style="font-weight:600; display:block; margin-bottom:5px;">Game Mode</label>
							<select id="modeSelect">
								<option value="simple">Simple (9×9, 10 mines)</option>
								<option value="medium">Medium (16×16, 40 mines)</option>
								<option value="expert">Expert (30×16, 99 mines)</option>
								<option value="custom">Custom</option>
							</select>
							
							<div
								id="customParams"
								style="display:none; margin-top:12px; gap:8px;"
							>
								<label style="display:block; font-weight:600; margin-bottom:8px;">
									Custom Board
								</label>
								<div style="display:flex; gap:8px;">
									<input
										id="customW"
										type="number"
										min="9"
										max="50"
										step="1"
										placeholder="Width (9-50)"
										style="flex:1; padding:8px; border-radius:8px;"
									>
									<input
										id="customH"
										type="number"
										min="9"
										max="30"
										step="1"
										placeholder="Height (9-30)"
										style="flex:1; padding:8px; border-radius:8px;"
									>
								</div>
								<div
									style="display:flex; gap:8px; margin-top:8px; align-items:center;"
								>
									<input
										id="customM"
										type="number"
										min="0"
										step="1"
										placeholder="Mines"
										style="flex:1; padding:8px; border-radius:8px;"
									>
									<div id="customHint" style="font-size:12px; color:#666;">
										Mines max = W × H - 9
									</div>
								</div>
							</div>
						</div>

						<button id="createLobbyBtn" class="big-btn">Create Room</button>
					</div>

					<div id="hostControls" style="display:none; margin-top:25px;">
						<button id="startGameBtn" class="big-btn" style="margin-top:12px;">
							Start Game
						</button>
						<button
							id="leaveLobbyBtn"
							class="big-btn"
							style="margin-top:12px; background: linear-gradient(to bottom, #ff6b6b, #c0392b) !important;"
						>
							Leave Room
						</button>
					</div>

					<div
						id="roomInfo"
						style="display:none; margin-top:25px; padding:18px; background:rgba(0,0,0,0.06); border-radius:12px;"
					>
						<div style="margin-bottom:12px;">
							<div style="margin-bottom:8px;">
								<strong>Room Name:</strong>
								<span
									id="currentRoomName"
									style="color:var(--accent); font-weight:bold; font-size:18px;"
								></span>
							</div>
							<div>
								<strong>Room ID:</strong>
								<span
									id="currentRoomId"
									style="font-family:monospace; background:#0001; padding:4px 8px; border-radius:6px;"
								></span>
								<button
									id="copyRoomBtn"
									style="margin-left:10px; padding:4px 10px; font-size:13px;"
								>
									Copy ID
								</button>
							</div>
						</div>
						<p style="margin:15px 0 8px 0; font-weight:600;">Players:</p>
						<ul id="playersList" style="margin:0; padding-left:20px;"></ul>
					</div>
				</div>

				<!-- Right Panel -->
				<div class="right-panel">
					<div id="personalStats">
						<h3>Personal Statistics</h3>
						<div
							style="display:flex; align-items:center; gap:8px; margin-bottom:12px; justify-content:center;"
						>
							<label for="statsModeSelect" style="font-weight:600;">Mode</label>
							<select
								id="statsModeSelect"
								style="padding:8px; border-radius:8px;"
							>
								<option value="simple">Simple</option>
								<option value="medium">Medium</option>
								<option value="expert">Expert</option>
							</select>
						</div>

						<div class="stat-row">
							<span class="stat-label">Games Played</span>
							<span id="statGamesPlayed" class="stat-value">0</span>
						</div>

						<div class="stat-row">
							<span class="stat-label">Games Won</span>
							<span id="statGamesWon" class="stat-value">0</span>
						</div>

						<div class="stat-row">
							<span class="stat-label">Win Rate</span>
							<span id="statWinRate" class="stat-value">0%</span>
						</div>

						<div class="stat-row">
							<span class="stat-label">Best Time</span>
							<span id="statBestTime" class="stat-value">--:--</span>
						</div>

						<!-- Total Play Time removed per request -->
					</div>

					<div id="leaderboard" style="margin-top: 25px;">
						<h3>Leaderboard</h3>
						<div
							style="display:flex; align-items:center; gap:8px; margin-bottom:12px; justify-content:center;"
						>
							<label for="leaderboardModeSelect" style="font-weight:600;">Mode</label>
							<select
								id="leaderboardModeSelect"
								style="padding:8px; border-radius:8px;"
							>
								<option value="simple">Simple</option>
								<option value="medium">Medium</option>
								<option value="expert">Expert</option>
							</select>
						</div>

						<div class="leaderboard-header" style="display: grid; grid-template-columns: 0.5fr 2fr 1fr 1fr 1fr 1fr; gap: 5px; font-weight: bold; font-size: 0.9em; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #ccc;">
							<span style="text-align: center;">#</span>
							<span>Player</span>
							<span style="text-align: center;">Games</span>
							<span style="text-align: center;">Wins</span>
							<span style="text-align: center;">Rate</span>
							<span style="text-align: right;">Best</span>
						</div>
						<div id="leaderboardList" style="font-size: 0.9em;">
							<div style="text-align: center; color: #888; padding: 10px;">Loading...</div>
						</div>
					</div>

					<!-- Gameplay Settings removed from Lobby - managed via Side Menu -->
				</div>
			</div>
		</div>

		<!-- Game Page removed -->

		<script src="front.js"></script>
		<!-- Side menu partial removed - loaded in front.js -->
	</body>
</html>
